# News Aggregator - Система агрегации и публикации новостей

## Описание проекта

News Aggregator - это система для автоматического парсинга новостей с различных сайтов, их обработки (включая рерайтинг через DeepSeek API) и публикации в социальные сети (Telegram, VK). Система включает десктопное GUI приложение и REST API для интеграции с веб-сайтами.

## Цели проекта

- Автоматический парсинг новостей с настраиваемых источников
- Интеллектуальная обработка контента (рерайтинг, редактирование)
- Публикация в социальные сети с предварительным просмотром
- Удобный GUI для управления процессом
- REST API для интеграции с веб-сайтами
- Система управления источниками и настройками

## Архитектура проекта

### Технологический стек

**Core (Python):**
- Python 3.8+
- SQLite для локального хранения данных
- Requests для HTTP запросов
- BeautifulSoup для парсинга HTML
- DeepSeek API для рерайтинга

**GUI (Desktop):**
- Tkinter для десктопного интерфейса
- Custom dark theme дизайн
- Диалоги для редактирования и сравнения контента

**API (REST):**
- FastAPI для REST API
- Pydantic для валидации данных
- Uvicorn для ASGI сервера

**Интеграция:**
- REST API для интеграции с PHP/Node.js/другими языками
- JSON формат для обмена данными
- Аутентификация через API ключи

### Структура проекта

```
news_aggregator/
├── core/                    # Бизнес-логика
│   ├── __init__.py
│   ├── parser.py           # Парсинг новостей
│   ├── publisher.py        # Публикация в соцсети
│   ├── paraphraser.py      # Рерайтинг через DeepSeek
│   └── db.py              # Работа с базой данных
├── gui.py                  # Десктопное GUI
├── api_server.py           # REST API сервер
├── main.py                 # Точка входа
├── requirements.txt        # Зависимости
├── design.json            # Конфигурация дизайна
├── news_aggregator.env    # Переменные окружения
├── aggregators.db         # SQLite база данных
└── docs/                  # Документация
    ├── Project.md
    ├── Tasktracker.md
    ├── Diary.md
    ├── changelog.md
    ├── qa.md
    └── api_integration.md
```

## Основные функции

### 1. Парсинг новостей
- Автоматический парсинг с настраиваемых сайтов
- Извлечение заголовков, текста, ссылок
- Обработка различных форматов HTML
- Система правил для разных сайтов

### 2. Обработка контента
- Рерайтинг через DeepSeek API
- Редактирование prompt для рерайтинга
- Сравнение оригинального и обработанного текста
- Возможность ручного редактирования

### 3. Публикация
- Публикация в Telegram каналы
- Публикация в VK группы/паблики
- Предварительный просмотр контента
- Обновление статуса в базе данных

### 4. GUI интерфейс
- Dark theme дизайн
- Управление источниками новостей
- Настройка параметров публикации
- Диалоги редактирования и сравнения

### 5. REST API
- Эндпоинты для парсинга и публикации
- Интеграция с веб-сайтами
- JSON API для внешних систем

## Этапы разработки

### Этап 1: Базовая функциональность (Завершен)
- [x] Парсинг новостей с сайтов
- [x] Публикация в Telegram
- [x] Публикация в VK
- [x] Базовая GUI

### Этап 2: Расширенная функциональность (Завершен)
- [x] Интеграция с DeepSeek API
- [x] Диалоги редактирования и сравнения
- [x] Dark theme дизайн
- [x] Система управления источниками

### Этап 3: REST API (Завершен)
- [x] FastAPI сервер
- [x] Эндпоинты для парсинга и публикации
- [x] Документация API
- [x] Примеры интеграции

### Этап 4: Оптимизация и тестирование (В процессе)
- [ ] Обработка ошибок и повторные попытки
- [ ] Unit тесты
- [ ] Интеграционные тесты
- [ ] Мониторинг и логирование

### Этап 5: Деплой и документация (Планируется)
- [ ] Docker контейнеризация
- [ ] CI/CD pipeline
- [ ] Продакшн деплой
- [ ] Полная документация

## API Endpoints

### Парсинг и публикация
- `POST /parse` - Парсинг новостей с указанного URL
- `POST /publish` - Публикация новости в соцсети
- `POST /paraphrase` - Рерайтинг текста через DeepSeek
- `GET /news` - Получение списка новостей

### Управление источниками
- `GET /sources` - Получение списка источников
- `POST /sources` - Добавление нового источника
- `PUT /sources/{id}` - Обновление источника
- `DELETE /sources/{id}` - Удаление источника

## База данных

### Основные таблицы
- `aggregators` - Настройки источников новостей
- `news` - Сохраненные новости
- `published` - История публикаций

## Конфигурация

### Переменные окружения (.env)
- `TELEGRAM_BOT_TOKEN` - Токен Telegram бота
- `VK_ACCESS_TOKEN` - Токен доступа VK API
- `DEEPSEEK_API_KEY` - API ключ DeepSeek
- `VK_GROUP_ID` - ID группы VK для публикации
- `TELEGRAM_CHANNEL_ID` - ID канала Telegram

### Дизайн (design.json)
- Цветовая схема dark theme
- Размеры и отступы элементов
- Шрифты и стили
- Параметры окон и диалогов

## Интеграция с веб-сайтами

### PHP пример
```php
$response = file_get_contents('http://localhost:8000/parse', false, stream_context_create([
    'http' => [
        'method' => 'POST',
        'header' => 'Content-Type: application/json',
        'content' => json_encode(['url' => 'https://example.com/news'])
    ]
]));
```

### Node.js пример
```javascript
const response = await fetch('http://localhost:8000/publish', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        title: 'Заголовок',
        text: 'Текст новости',
        networks: ['telegram', 'vk']
    })
});
```

## Безопасность

### API безопасность
- Валидация входных данных через Pydantic
- Rate limiting для API запросов
- Логирование всех операций
- Обработка ошибок и исключений

### Конфиденциальность
- Безопасное хранение API ключей
- Шифрование чувствительных данных
- Логирование без персональных данных

## Производительность

### Оптимизация
- Асинхронная обработка запросов
- Кэширование результатов парсинга
- Оптимизация запросов к базе данных
- Ограничение размера обрабатываемых данных

### Мониторинг
- Логирование времени выполнения операций
- Отслеживание ошибок API
- Мониторинг использования ресурсов
- Метрики успешности публикаций

## Команда разработки

- **Python Developer** - Core логика и API
- **GUI Developer** - Десктопный интерфейс
- **DevOps Engineer** - Деплой и инфраструктура
- **QA Engineer** - Тестирование
- **UI/UX Designer** - Дизайн интерфейса

## Риски и митигация

### Технические риски
- **Риск**: Изменения в структуре парсируемых сайтов
  **Митигация**: Гибкая система правил парсинга, мониторинг ошибок

- **Риск**: Ограничения API социальных сетей
  **Митигация**: Rate limiting, обработка ошибок, повторные попытки

- **Риск**: Проблемы с DeepSeek API (лимиты, доступность)
  **Митигация**: Fallback на оригинальный текст, мониторинг статуса API

### Бизнес риски
- **Риск**: Нарушение ToS парсируемых сайтов
  **Митигация**: Соблюдение robots.txt, разумные интервалы запросов

- **Риск**: Проблемы с модерацией контента в соцсетях
  **Митигация**: Предварительная проверка контента, настройка фильтров

## Метрики успеха

- Количество успешно обработанных новостей
- Время отклика системы
- Процент успешных публикаций
- Покрытие тестами
- Удовлетворенность пользователей GUI
- Количество интеграций с внешними системами 